<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
                                       http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.8.xsd
                                       http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet author="basti" id="0.0.1-User_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate user table</comment>
        <sql>
            CREATE TABLE `poker`.`users` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `EMAIL` VARCHAR(45) NOT NULL,
            `NAME` VARCHAR(45) NOT NULL,
            `ADMIN` TINYINT NOT NULL DEFAULT 0,
            `PASS` VARCHAR(45) NOT NULL,
            PRIMARY KEY (`ID`),
            UNIQUE INDEX `ID_UNIQUE` (`ID` ASC),
            UNIQUE INDEX `EMAIl_UNIQUE` (`EMAIL` ASC));
        </sql>
    </changeSet>

    <changeSet author="basti" id="0.0.1-lobbies_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate lobby table</comment>
        <sql>
            CREATE TABLE `poker`.`lobbies` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `name` VARCHAR(45) NOT NULL,
            `money` INT NOT NULL DEFAULT 500,
            `small_blind` INT NOT NULL DEFAULT 5,
            `big_blind` INT NOT NULL DEFAULT 10,
            `interval_rounds` INT NULL,
            `interval_time` INT NULL DEFAULT 20,
            `idle_time` INT NOT NULL,
            `player1` INT NULL,
            `player2` INT NULL,
            `player3` INT NULL,
            `player4` INT NULL,
            `player5` INT NULL,
            `player6` INT NULL,
            `player7` INT NULL,
            `player8` INT NULL,
            `creator` INT NOT NULL,
            PRIMARY KEY (`ID`),
            INDEX `index2` (`ID` ASC),
            INDEX `creator_users_idx` (`creator` ASC),
            INDEX `p1_user_idx` (`player1` ASC),
            INDEX `p2_user_idx` (`player2` ASC),
            INDEX `p3_user_idx` (`player3` ASC),
            INDEX `p4_user_idx` (`player4` ASC),
            INDEX `p5_user_idx` (`player5` ASC),
            INDEX `p6_user_idx` (`player6` ASC),
            INDEX `p7_user_idx` (`player7` ASC),
            INDEX `p8_user_idx` (`player8` ASC),
            CONSTRAINT `creator_users`
            FOREIGN KEY (`creator`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p1_user`
            FOREIGN KEY (`player1`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p2_user`
            FOREIGN KEY (`player2`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p3_user`
            FOREIGN KEY (`player3`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p4_user`
            FOREIGN KEY (`player4`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p5_user`
            FOREIGN KEY (`player5`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p6_user`
            FOREIGN KEY (`player6`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p7_user`
            FOREIGN KEY (`player7`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
            CONSTRAINT `p8_user`
            FOREIGN KEY (`player8`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE);
        </sql>
    </changeSet>

    <changeSet author="basti" id="0.0.1-players_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate players table</comment>
        <sql>
            CREATE TABLE `poker`.`players` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `user` INT NOT NULL,
            `game` INT NOT NULL,
            `money` INT NOT NULL,
            `card1` VARCHAR(45) NULL,
            `card2` VARCHAR(45) NULL,
            PRIMARY KEY (`ID`),
            INDEX `index2` (`ID` ASC),
            INDEX `player_user_idx` (`user` ASC),
            INDEX `player_game_idx` (`game` ASC),
            CONSTRAINT `player_user`
            FOREIGN KEY (`user`)
            REFERENCES `poker`.`users` (`ID`)
            ON DELETE CASCADE
            ON UPDATE CASCADE);
        </sql>
    </changeSet>


    <changeSet author="basti" id="0.0.1-games_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate games table</comment>
        <sql>
            CREATE TABLE `poker`.`games` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `NAME` VARCHAR(45) NOT NULL,
            `CREATOR` VARCHAR(45) NOT NULL,
            `CREATED` DATETIME NOT NULL,
            `FINISHED` DATETIME NULL,
            `PLAYER1` VARCHAR(45) NOT NULL,
            `PLAYER2` VARCHAR(45) NOT NULL,
            `PLAYER3` VARCHAR(45) NULL,
            `PLAYER4` VARCHAR(45) NULL,
            `PLAYER5` VARCHAR(45) NULL,
            `PLAYER6` VARCHAR(45) NULL,
            `PLAYER7` VARCHAR(45) NULL,
            `PLAYER8` VARCHAR(45) NULL,
            `SMALL_BLIND` INT NOT NULL,
            `BIG_BLIND` INT NOT NULL,
            `INTERVALL_TIME` INT NULL,
            `INTERVALL_ROUNDS` INT NULL,
            `STARTING_MONEY` INT NULL,
            `IDLE_TIME` INT NOT NULL,
            `WINNER` VARCHAR(45) NULL,
            `GAME_TIME` INT NULL,
            `GAME_ROUNDS` INT NULL,
            PRIMARY KEY (`ID`),
            UNIQUE INDEX `NAME_UNIQUE` (`NAME` ASC));

            ALTER TABLE `poker`.`games`
            CHANGE COLUMN `CREATOR` `CREATOR` INT NOT NULL ,
            CHANGE COLUMN `PLAYER1` `PLAYER1` INT NOT NULL ,
            CHANGE COLUMN `PLAYER2` `PLAYER2` INT NOT NULL ,
            CHANGE COLUMN `PLAYER3` `PLAYER3` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `PLAYER4` `PLAYER4` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `PLAYER5` `PLAYER5` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `PLAYER6` `PLAYER6` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `PLAYER7` `PLAYER7` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `PLAYER8` `PLAYER8` INT NULL DEFAULT NULL ,
            CHANGE COLUMN `WINNER` `WINNER` INT NULL DEFAULT NULL ,
            ADD INDEX `creator_player_idx` (`CREATOR` ASC),
            ADD INDEX `p1_player_idx` (`PLAYER1` ASC),
            ADD INDEX `p2_player_idx` (`PLAYER2` ASC),
            ADD INDEX `p3_player_idx` (`PLAYER3` ASC),
            ADD INDEX `p4_player_idx` (`PLAYER4` ASC),
            ADD INDEX `p5_player_idx` (`PLAYER5` ASC),
            ADD INDEX `p6_player_idx` (`PLAYER6` ASC),
            ADD INDEX `p7_player_idx` (`PLAYER7` ASC),
            ADD INDEX `p8_player_idx` (`PLAYER8` ASC),
            ADD INDEX `winner_player_idx` (`WINNER` ASC);
            ;
            ALTER TABLE `poker`.`games`
            ADD CONSTRAINT `creator_player`
            FOREIGN KEY (`CREATOR`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p1_player`
            FOREIGN KEY (`PLAYER1`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p2_player`
            FOREIGN KEY (`PLAYER2`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p3_player`
            FOREIGN KEY (`PLAYER3`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p4_player`
            FOREIGN KEY (`PLAYER4`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p5_player`
            FOREIGN KEY (`PLAYER5`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p6_player`
            FOREIGN KEY (`PLAYER6`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p7_player`
            FOREIGN KEY (`PLAYER7`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `p8_player`
            FOREIGN KEY (`PLAYER8`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            ADD CONSTRAINT `winner_player`
            FOREIGN KEY (`WINNER`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION;
        </sql>
    </changeSet>

    <changeSet author="basti" id="0.0.1-rounds_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate rounds table</comment>
        <sql>
            CREATE TABLE `poker`.`rounds` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `game` INT NOT NULL,
            `number` INT NOT NULL DEFAULT 1,
            `deck` VARCHAR(1024) NOT NULL,
            `open_cards` VARCHAR(45) NULL,
            `pots` VARCHAR(1024) NULL,
            `removed_cards` VARCHAR(1024) NULL,
            `p1_cards` VARCHAR(45) NULL,
            `p2_cards` VARCHAR(45) NULL,
            `p3_cards` VARCHAR(45) NULL,
            `p4_cards` VARCHAR(45) NULL,
            `p5_cards` VARCHAR(45) NULL,
            `p6_cards` VARCHAR(45) NULL,
            `p7_cards` VARCHAR(45) NULL,
            `p8_cards` VARCHAR(45) NULL,
            `current_rurn` INT NULL,
            `dealer` INT NOT NULL,
            `big_blind` INT NOT NULL,
            `small_blind` INT NOT NULL,
            PRIMARY KEY (`ID`),
            INDEX `round_game_idx` (`game` ASC),
            INDEX `dealer_player_idx` (`dealer` ASC),
            CONSTRAINT `round_game`
            FOREIGN KEY (`game`)
            REFERENCES `poker`.`games` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            CONSTRAINT `dealer_player`
            FOREIGN KEY (`dealer`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION);
        </sql>
    </changeSet>

    <changeSet author="basti" id="0.0.1-turns_table_create" logicalFilePath="schema/changelog/poker-schema-0.0.1.1.xml">
        <comment>Crate turns table</comment>
        <sql>
            CREATE TABLE `poker`.`turns` (
            `ID` INT NOT NULL AUTO_INCREMENT,
            `round` INT NOT NULL,
            `type` VARCHAR(45) NOT NULL,
            `player_turn` INT NOT NULL,
            `finished` TINYINT NOT NULL,
            `p1_bet` VARCHAR(45) NULL,
            `p2_bet` VARCHAR(45) NULL,
            `p3_bet` VARCHAR(45) NULL,
            `p4_bet` VARCHAR(45) NULL,
            `p5_bet` VARCHAR(45) NULL,
            `p6_bet` VARCHAR(45) NULL,
            `p7_bet` VARCHAR(45) NULL,
            `p8_bet` VARCHAR(45) NULL,
            PRIMARY KEY (`ID`),
            INDEX `turn_round_idx` (`round` ASC),
            INDEX `pturn_player_idx` (`player_turn` ASC),
            CONSTRAINT `turn_round`
            FOREIGN KEY (`round`)
            REFERENCES `poker`.`rounds` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
            CONSTRAINT `pturn_player`
            FOREIGN KEY (`player_turn`)
            REFERENCES `poker`.`players` (`ID`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION);
        </sql>
    </changeSet>

</databaseChangeLog>